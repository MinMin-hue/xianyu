import{d as ie,c as h,o as _,a as e,x as ce,s as re,r as B,A as U,b as ue,D as Z,F as le,j as pe,q as J,t as S,e as Te,l as Y,m as oe,y as Se,E as xe,i as se,g as w,w as P,u as G,f as he,G as Ce,H as be,h as Ie}from"./index-BH-S8nGy.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as ye}from"./Settings-p-72vceY.js";import{C as Me}from"./CheckmarkCircle-D7tQpNWb.js";import{R as De}from"./Refresh-Ddqf3QFR.js";import{_ as Be}from"./xiaoyugan-Dwisk7G8.js";const We={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ue=e("path",{d:"M480 128a64 64 0 0 0-64-64h-16V48.45c0-8.61-6.62-16-15.23-16.43A16 16 0 0 0 368 48v16H144V48.45c0-8.61-6.62-16-15.23-16.43A16 16 0 0 0 112 48v16H96a64 64 0 0 0-64 64v12a4 4 0 0 0 4 4h440a4 4 0 0 0 4-4z",fill:"currentColor"},null,-1),Ee=e("path",{d:"M32 416a64 64 0 0 0 64 64h320a64 64 0 0 0 64-64V179a3 3 0 0 0-3-3H35a3 3 0 0 0-3 3zm344-208a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm-80-80a24 24 0 1 1-24 24a24 24 0 0 1 24-24zm0 80a24 24 0 1 1-24 24a24 24 0 0 1 24-24z",fill:"currentColor"},null,-1),Oe=[Ue,Ee],ze=ie({name:"Calendar",render:function(n,r){return _(),h("svg",We,Oe)}}),He={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ae=e("path",{d:"M424.44 227.25a16 16 0 0 1-12.12-12.39c-7.68-36.68-24.45-68.15-49.18-92A153.57 153.57 0 0 0 256 80c-35.5 0-68.24 11.69-94.68 33.8a156.24 156.24 0 0 0-42 56a16 16 0 0 1-11.37 9.15c-27 5.62-51.07 17.34-69.18 33.87C13.39 235.88 0 267.42 0 304c0 36 14.38 68.88 40.49 92.59C65.64 419.43 99.56 432 136 432h260c32.37 0 60.23-8.57 80.59-24.77C499.76 388.78 512 361.39 512 328c0-57.57-42-90.58-87.56-100.75zm-95.2-8.94l-107.8 128a16 16 0 0 1-12 5.69h-.27a16 16 0 0 1-11.88-5.28l-45.9-50.87c-5.77-6.39-5.82-16.33.3-22.4a16 16 0 0 1 23.16.63l33.9 37.58l96-114a16 16 0 1 1 24.48 20.62z",fill:"currentColor"},null,-1),Ne=[Ae],Re=ie({name:"CloudDone",render:function(n,r){return _(),h("svg",He,Ne)}}),Pe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ve=e("path",{d:"M428 224H288a48 48 0 0 1-48-48V36a4 4 0 0 0-4-4h-92a64 64 0 0 0-64 64v320a64 64 0 0 0 64 64h224a64 64 0 0 0 64-64V228a4 4 0 0 0-4-4zm-92 160H176a16 16 0 0 1 0-32h160a16 16 0 0 1 0 32zm0-80H176a16 16 0 0 1 0-32h160a16 16 0 0 1 0 32z",fill:"currentColor"},null,-1),Le=e("path",{d:"M419.22 188.59L275.41 44.78a2 2 0 0 0-3.41 1.41V176a16 16 0 0 0 16 16h129.81a2 2 0 0 0 1.41-3.41z",fill:"currentColor"},null,-1),Ge=[Ve,Le],je=ie({name:"DocumentText",render:function(n,r){return _(),h("svg",Pe,Ge)}}),Je={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},qe=e("circle",{cx:"256",cy:"256",r:"192",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Xe=[qe],Ye=ie({name:"EllipseOutline",render:function(n,r){return _(),h("svg",Je,Xe)}}),Ke="/icons/173746572831736.png",Qe="/icons/174061875626614.png",Ze="/icons/1733492491706152.png",we="/icons/1733492491706148.png",Fe="/icons/1736425783912140.png",et="/icons/Ob7pyorzmHiJcbab2c25af264d0758b527bc1b61cc3b.png",tt={class:"team-status-card"},st={class:"card-header"},at={class:"team-selector"},nt=["disabled","onClick"],ot=["disabled"],lt={class:"card-content"},it={class:"team-display"},ct={class:"current-team-info"},rt={class:"team-number"},ut={class:"heroes-container"},dt={key:0,class:"heroes-inline"},mt={class:"hero-circle"},pt=["src","alt"],vt={key:1,class:"hero-placeholder"},gt={class:"hero-name"},ft={key:1,class:"empty-team"},_t={key:2,class:"empty-team"},ht=ie({__name:"TeamStatus",setup(te){const n={101:{name:"司马懿",type:"魏国"},102:{name:"郭嘉",type:"魏国"},103:{name:"关羽",type:"蜀国"},104:{name:"诸葛亮",type:"蜀国"},105:{name:"周瑜",type:"吴国"},106:{name:"太史慈",type:"吴国"},107:{name:"吕布",type:"群雄"},108:{name:"华佗",type:"群雄"},109:{name:"甄姬",type:"魏国"},110:{name:"黄月英",type:"蜀国"},111:{name:"孙策",type:"吴国"},112:{name:"贾诩",type:"群雄"},113:{name:"曹仁",type:"魏国"},114:{name:"姜维",type:"蜀国"},115:{name:"孙坚",type:"吴国"},116:{name:"公孙瓒",type:"群雄"},117:{name:"典韦",type:"魏国"},118:{name:"赵云",type:"蜀国"},119:{name:"大乔",type:"吴国"},120:{name:"张角",type:"群雄"},201:{name:"徐晃",type:"魏国"},202:{name:"荀彧",type:"魏国"},203:{name:"典韦",type:"魏国"},204:{name:"张飞",type:"蜀国"},205:{name:"赵云",type:"蜀国"},206:{name:"庞统",type:"蜀国"},207:{name:"鲁肃",type:"吴国"},208:{name:"陆逊",type:"吴国"},209:{name:"甘宁",type:"吴国"},210:{name:"貂蝉",type:"群雄"},211:{name:"董卓",type:"群雄"},212:{name:"张角",type:"群雄"},213:{name:"张辽",type:"魏国"},214:{name:"夏侯惇",type:"魏国"},215:{name:"许褚",type:"魏国"},216:{name:"夏侯渊",type:"魏国"},217:{name:"魏延",type:"蜀国"},218:{name:"黄忠",type:"蜀国"},219:{name:"马超",type:"蜀国"},220:{name:"马岱",type:"蜀国"},221:{name:"吕蒙",type:"吴国"},222:{name:"黄盖",type:"吴国"},223:{name:"蔡文姬",type:"魏国"},224:{name:"小乔",type:"吴国"},225:{name:"袁绍",type:"群雄"},226:{name:"华雄",type:"群雄"},227:{name:"颜良",type:"群雄"},228:{name:"文丑",type:"群雄"},301:{name:"周泰",type:"吴国"},302:{name:"许攸",type:"魏国"},303:{name:"于禁",type:"魏国"},304:{name:"张星彩",type:"蜀国"},305:{name:"关银屏",type:"蜀国"},306:{name:"关平",type:"蜀国"},307:{name:"程普",type:"吴国"},308:{name:"张昭",type:"吴国"},309:{name:"陆绩",type:"吴国"},310:{name:"吕玲绮",type:"群雄"},311:{name:"潘凤",type:"群雄"},312:{name:"邢道荣",type:"群雄"},313:{name:"祝融夫人",type:"群雄"},314:{name:"孟获",type:"群雄"}},r=ce(),l=re(),o=B(!1),M=B(!1),$=B(1),E=B([1,2,3,4]),v=U(()=>r.selectedToken?r.getWebSocketStatus(r.selectedToken.id):"disconnected"),O=U(()=>{var a;return((a=r.gameData)==null?void 0:a.presetTeam)??null});function q(a){var me;if(!a)return{useTeamId:1,teams:{}};const s=a.presetTeamInfo??a,p=j=>{if(!j||typeof j!="object")return null;if(typeof j.useTeamId=="number")return j.useTeamId;for(const F of Object.keys(j)){const L=p(j[F]);if(L)return L}return null},f=s.useTeamId??((me=s.presetTeamInfo)==null?void 0:me.useTeamId)??p(s)??1,k=s.presetTeamInfo??s,x={},V=Object.keys(k||{}).filter(j=>/^\d+$/.test(j));for(const j of V){const F=Number(j),L=k[j];if(!L){x[F]={teamInfo:{}};continue}if(L.teamInfo)x[F]={teamInfo:L.teamInfo};else if(L.heroes){const ae={};L.heroes.forEach((ne,i)=>{ae[String(i+1)]=ne}),x[F]={teamInfo:ae}}else if(typeof L=="object"){const ae=Object.values(L).some(ne=>ne&&typeof ne=="object"&&"heroId"in ne);x[F]={teamInfo:ae?L:{}}}else x[F]={teamInfo:{}}}return{useTeamId:Number(f)||1,teams:x}}const z=U(()=>q(O.value)),K=U(()=>{var p;const a=(p=z.value.teams[$.value])==null?void 0:p.teamInfo;if(!a)return[];const s=[];for(const[f,k]of Object.entries(a)){const x=(k==null?void 0:k.heroId)??(k==null?void 0:k.id);if(!x)continue;const V=n[Number(x)];s.push({id:Number(x),name:(V==null?void 0:V.name)??`英雄${x}`,type:(V==null?void 0:V.type)??"",position:Number(f),level:(k==null?void 0:k.level)??1,avatar:k==null?void 0:k.avatar})}return s.sort((f,k)=>f.position-k.position),s}),g=async(a,s,p={},f="",k=8e3)=>{try{return await r.sendMessageWithPromise(a,s,p,k)}catch(x){const V=(x==null?void 0:x.message)??String(x);throw f&&l.error(`${f}失败：${V}`),x}},d=async(a=!1)=>{var p,f;if(!r.selectedToken)return l.warning("请先选择Token"),null;const s=r.selectedToken.id;if(!a){const k=(f=(p=r.gameData)==null?void 0:p.presetTeam)==null?void 0:f.presetTeamInfo;if(k)return k}o.value=!0;try{const k=await g(s,"presetteam_getinfo",{},"获取阵容信息");return r.$patch(x=>{x.gameData={...x.gameData??{},presetTeam:k}}),(k==null?void 0:k.presetTeamInfo)??null}catch(k){return console.error("获取阵容信息失败:",k),null}finally{o.value=!1}},T=()=>{const a=Object.keys(z.value.teams).map(Number).filter(s=>!Number.isNaN(s)).sort((s,p)=>s-p);E.value=a.length?a:[1,2,3,4]},C=()=>{$.value=z.value.useTeamId||1},A=async a=>{if(M.value||o.value)return;if(!r.selectedToken){l.warning("请先选择Token");return}const s=$.value;M.value=!0;try{await g(r.selectedToken.id,"presetteam_saveteam",{teamId:a},`切换到阵容 ${a}`),$.value=a,l.success(`已切换到阵容 ${a}`),await I(!0)}catch{$.value=s}finally{M.value=!1}},I=async(a=!1)=>{await d(a)};return ue(async()=>{r.selectedToken&&v.value==="connected"?(await I(!1),T(),C(),O.value||(await I(!0),T(),C())):r.selectedToken?console.log("🛡️ WebSocket未连接，等待连接后自动获取队伍信息"):console.log("🛡️ 没有选中的Token，无法获取队伍信息")}),Z(v,(a,s)=>{console.log(`🛡️ WebSocket状态变化: ${s} -> ${a}`),a==="connected"&&s!=="connected"&&r.selectedToken&&(console.log("🛡️ WebSocket已连接，自动获取队伍信息"),setTimeout(async()=>{await I(!1),T(),C(),O.value||(await I(!0),T(),C())},1e3))}),Z(()=>r.selectedToken,async(a,s)=>{a&&a.id!==(s==null?void 0:s.id)&&(console.log("🛡️ Token已切换，重新获取队伍信息"),r.getWebSocketStatus(a.id)==="connected"&&(await I(!0),T(),C()))}),Z(()=>O.value,()=>{T(),C()},{deep:!0}),(a,s)=>(_(),h("div",tt,[e("div",st,[s[2]||(s[2]=e("img",{src:et,alt:"队伍图标",class:"team-icon"},null,-1)),s[3]||(s[3]=e("div",{class:"team-info"},[e("h3",null,"队伍阵容"),e("p",null,"当前使用的战斗阵容")],-1)),e("div",at,[(_(!0),h(le,null,pe(E.value,p=>(_(),h("button",{key:p,disabled:o.value||M.value,class:J(["team-button",{active:$.value===p}]),onClick:f=>A(p)},S(p),11,nt))),128)),e("button",{class:"refresh-button",disabled:o.value,title:"刷新队伍数据",onClick:s[0]||(s[0]=p=>I(!0))},s[1]||(s[1]=[Te('<svg class="refresh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-43018590><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" data-v-43018590></path><path d="M21 3v5h-5" data-v-43018590></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" data-v-43018590></path><path d="M3 21v-5h5" data-v-43018590></path></svg><span class="refresh-text" data-v-43018590>刷新</span>',2)]),8,ot)])]),e("div",lt,[e("div",it,[e("div",ct,[s[4]||(s[4]=e("span",{class:"label"},"当前阵容",-1)),e("span",rt,[o.value?(_(),h(le,{key:1},[Y("加载中…")],64)):(_(),h(le,{key:0},[Y("阵容 "+S($.value),1)],64))])]),e("div",ut,[o.value?oe("",!0):(_(),h("div",dt,[(_(!0),h(le,null,pe(K.value,p=>{var f;return _(),h("div",{key:p.id||p.name,class:"hero-item"},[e("div",mt,[p.avatar?(_(),h("img",{key:0,src:p.avatar,alt:p.name,class:"hero-avatar"},null,8,pt)):(_(),h("div",vt,S(((f=p.name)==null?void 0:f.substring(0,2))||"?"),1))]),e("span",gt,S(p.name||"未知"),1)])}),128))])),!o.value&&!K.value.length?(_(),h("div",ft,s[5]||(s[5]=[e("p",null,"暂无队伍信息",-1)]))):oe("",!0),o.value?(_(),h("div",_t,s[6]||(s[6]=[e("p",null,"正在加载队伍信息…",-1)]))):oe("",!0)])])])]))}}),yt=de(ht,[["__scopeId","data-v-43018590"]]),kt="/icons/174023274867420.png",Tt={class:"daily-task-container"},bt={class:"task-header"},wt={class:"header-right"},$t={class:"progress-container"},St=["disabled"],xt={key:0,class:"loading-text"},Ct={key:1},It={key:2},Mt={class:"modal-header"},Dt={class:"settings-content"},Bt={class:"settings-grid"},Wt={class:"setting-item"},Ut={class:"setting-item"},Et={class:"setting-item"},Ot={class:"setting-switches"},zt={class:"switch-row"},Ht={class:"switch-row"},At={class:"switch-row"},Nt={class:"switch-row"},Rt={class:"switch-row"},Pt={class:"switch-row"},Vt={class:"switch-row"},Lt={class:"modal-header"},Gt=["disabled"],jt={class:"task-list"},Jt={class:"task-item-left"},qt={class:"task-name"},Xt={class:"modal-header"},Yt={class:"log-time"},ke=500,Kt={__name:"DailyTaskStatus",setup(te){const n=ce(),r=re(),l=B(!1),o=B(!1),M=B(!1),$=B(!1),E=B(null),v=Se({arenaFormation:1,bossFormation:1,bossTimes:4,claimBottle:!0,payRecruit:!0,openBox:!0,arenaEnable:!0,claimHangUp:!0,claimEmail:!0,blackMarketPurchase:!0}),O=B([{id:1,name:"登录一次游戏",completed:!1,loading:!1},{id:2,name:"分享一次游戏",completed:!1,loading:!1},{id:3,name:"赠送好友3次金币",completed:!1,loading:!1},{id:4,name:"进行2次招募",completed:!1,loading:!1},{id:5,name:"领取5次挂机奖励",completed:!1,loading:!1},{id:6,name:"进行3次点金",completed:!1,loading:!1},{id:7,name:"开启3次宝箱",completed:!1,loading:!1},{id:12,name:"黑市购买1次物品（请设置采购清单）",completed:!1,loading:!1},{id:13,name:"进行1场竞技场战斗",completed:!1,loading:!1},{id:14,name:"收获1个任意盐罐",completed:!1,loading:!1}]),q=[1,2,3,4].map(i=>({label:`阵容${i}`,value:i})),z=[0,1,2,3,4].map(i=>({label:`${i}次`,value:i})),K=U(()=>n.selectedTokenRoleInfo),g=U(()=>{var i,t,y;return((y=(t=(i=K.value)==null?void 0:i.role)==null?void 0:t.dailyTask)==null?void 0:y.dailyPoint)??0}),d=U(()=>Math.min(g.value,100)),T=U(()=>d.value>=100),C=U(()=>T.value?"#10b981":"#3b82f6"),A=U(()=>n.selectedToken?n.getWebSocketStatus(n.selectedToken.id)==="connected":!1),I=B([]),a=(i,t="info")=>{const y=new Date().toLocaleTimeString();I.value.push({time:y,message:i,type:t}),I.value.length>ke&&I.value.splice(0,I.value.length-ke),Ce(()=>{E.value&&(E.value.scrollTop=E.value.scrollHeight)})},s=i=>{var W,H;if(!((H=(W=i==null?void 0:i.role)==null?void 0:W.dailyTask)!=null&&H.complete)){a("角色信息中无任务完成数据","warning");return}const t=i.role.dailyTask.complete,y=D=>D===-1;a("开始同步任务完成状态..."),a(`服务器返回的任务完成数据: ${JSON.stringify(t)}`);let u=0,N=0;O.value.forEach(D=>{D.completed=!1}),Object.keys(t).forEach(D=>{const c=Number(D),b=O.value.findIndex(ee=>ee.id===c);if(b>=0){const ee=y(t[D]);O.value[b].completed=ee,u++,ee&&N++,a(`任务${c} "${O.value[b].name}": ${ee?"已完成":"未完成"}`,ee?"success":"info")}else a(`服务器返回未知任务ID: ${c} (完成值: ${t[D]})`,"warning")}),O.value.forEach(D=>{D.id.toString()in t||a(`本地任务${D.id} "${D.name}" 在服务器数据中缺失`,"warning")}),a(`任务状态同步完成: ${N}/${u} 已完成`),a(`当前进度: ${g.value}/100`)},p=async()=>{if(!n.selectedToken)throw new Error("没有选中的Token");const i=n.selectedToken.id;a("正在获取角色信息...");try{const t=await n.sendGetRoleInfo(i);return a("角色信息获取成功","success"),t&&s(t),t}catch(t){throw a(`获取角色信息失败: ${t.message}`,"error"),t}},f=async(i,t,y={},u="",N=8e3)=>{try{u&&a(`执行: ${u}`);const W=await n.sendMessageWithPromise(i,t,y,N);return u&&a(`${u} - 成功`,"success"),W}catch(W){throw u&&a(`${u} - 失败: ${W.message}`,"error"),W}},k=i=>{if(!i)return!0;const t=new Date().toDateString(),y=new Date(i).toDateString();return t!==y},x=()=>{const i=[9904,9905,9901,9902,9903,9904,9905],t=new Date().getDay();return i[t]},V=async(i,t,y,u)=>{var N,W,H;try{const D=(W=(N=n.gameData)==null?void 0:N.presetTeam)==null?void 0:W.presetTeamInfo;let c=D==null?void 0:D.useTeamId;if(c)u(`从缓存获取当前阵容: ${c}`);else{u("缓存中无阵容信息，从服务器获取...");const b=await f(i,"presetteam_getinfo",{},"获取阵容信息");c=(H=b==null?void 0:b.presetTeamInfo)==null?void 0:H.useTeamId,u(`从服务器获取当前阵容: ${c}`)}return c===t?(u(`当前已是${y}${t}，无需切换`,"success"),!1):(u(`当前阵容: ${c}, 目标阵容: ${t}，开始切换...`),await f(i,"presetteam_saveteam",{teamId:t},`切换到${y}${t}`),u(`成功切换到${y}${t}`,"success"),!0)}catch(D){u(`阵容检查失败，直接切换: ${D.message}`,"warning");try{return await f(i,"presetteam_saveteam",{teamId:t},`强制切换到${y}${t}`),!0}catch(c){throw u(`强制切换也失败: ${c.message}`,"error"),c}}},me=async(i,t,y)=>{var fe;const u=n.selectedToken.id,N=i==null?void 0:i.role;if(!N)throw new Error("角色数据不存在");t("开始执行每日任务补差");const W=((fe=N.dailyTask)==null?void 0:fe.complete)??{},H=m=>W[m]===-1,D=N.statistics??{},c=N.statisticsTime??{},b=[];if(H(2)||b.push({name:"分享一次游戏",execute:()=>f(u,"system_mysharecallback",{isSkipShareCard:!0,type:2},"分享游戏")}),H(3)||b.push({name:"赠送好友金币",execute:()=>f(u,"friend_batch",{},"赠送好友金币")}),H(4)||(b.push({name:"免费招募",execute:()=>f(u,"hero_recruit",{recruitType:3,recruitNumber:1},"免费招募")}),v.payRecruit&&b.push({name:"付费招募",execute:()=>f(u,"hero_recruit",{recruitType:1,recruitNumber:1},"付费招募")})),!H(6)&&k(c["buy:gold"]))for(let m=0;m<3;m++)b.push({name:`免费点金 ${m+1}/3`,execute:()=>f(u,"system_buygold",{buyNum:1},`免费点金 ${m+1}`)});if(!H(5)&&v.claimHangUp){for(let m=0;m<4;m++)b.push({name:`挂机加钟 ${m+1}/4`,execute:()=>f(u,"system_mysharecallback",{isSkipShareCard:!0,type:2},`挂机加钟 ${m+1}`)});b.push({name:"领取挂机奖励",execute:()=>f(u,"system_claimhangupreward",{},"领取挂机奖励")}),b.push({name:"挂机加钟 5/5",execute:()=>f(u,"system_mysharecallback",{isSkipShareCard:!0,type:2},"挂机加钟 5")})}if(!H(7)&&v.openBox&&b.push({name:"开启木质宝箱",execute:()=>f(u,"item_openbox",{itemId:2001,number:10},"开启木质宝箱10个")}),!H(14)&&v.claimBottle&&b.push({name:"领取盐罐奖励",execute:()=>f(u,"bottlehelper_claim",{},"领取盐罐奖励")}),!H(13)&&v.arenaEnable&&b.push({name:"竞技场战斗",execute:async()=>{var m,Q;t("开始竞技场战斗流程"),await V(u,v.arenaFormation,"竞技场阵容",t),await f(u,"arena_startarea",{},"开始竞技场");for(let X=1;X<=3;X++){t(`竞技场战斗 ${X}/3`);const R=await f(u,"arena_getareatarget",{refresh:!1},`获取竞技场目标${X}`),_e=(Q=(m=R==null?void 0:R.roleList)==null?void 0:m[0])==null?void 0:Q.roleId;_e?await f(u,"fight_startareaarena",{targetId:_e},`竞技场战斗${X}`,1e4):t(`竞技场战斗${X} - 未找到目标`,"warning"),await new Promise($e=>setTimeout($e,1e3))}}}),v.bossTimes>0){const m=D["legion:boss"]??0,Q=Math.max(v.bossTimes-m,0);if(Q>0){b.push({name:"军团BOSS阵容检查",execute:()=>V(u,v.bossFormation,"BOSS阵容",t)});for(let R=0;R<Q;R++)b.push({name:`军团BOSS ${R+1}/${Q}`,execute:()=>f(u,"fight_startlegionboss",{},`军团BOSS ${R+1}`,12e3)})}const X=x();Q===0&&b.push({name:"每日BOSS阵容检查",execute:()=>V(u,v.bossFormation,"BOSS阵容",t)});for(let R=0;R<3;R++)b.push({name:`每日BOSS ${R+1}/3`,execute:()=>f(u,"fight_startboss",{bossId:X},`每日BOSS ${R+1}`,12e3)})}const ee=[{name:"福利签到",cmd:"system_signinreward"},{name:"俱乐部签到",cmd:"legion_signin"},{name:"领取每日礼包",cmd:"discount_claimreward"},{name:"领取免费礼包",cmd:"card_claimreward"},{name:"领取永久卡礼包",cmd:"card_claimreward",params:{cardId:4003}}];if(v.claimEmail&&ee.push({name:"领取邮件奖励",cmd:"mail_claimallattachment"}),ee.forEach(m=>{b.push({name:m.name,execute:()=>f(u,m.cmd,m.params||{},m.name)})}),k(c["artifact:normal:lottery:time"]))for(let m=0;m<3;m++)b.push({name:`免费钓鱼 ${m+1}/3`,execute:()=>f(u,"artifact_lottery",{lotteryNumber:1,newFree:!0,type:1},`免费钓鱼 ${m+1}`)});const ve=["魏国","蜀国","吴国","群雄"];for(let m=1;m<=4;m++)k(c[`genie:daily:free:${m}`])&&b.push({name:`${ve[m-1]}灯神免费扫荡`,execute:()=>f(u,"genie_sweep",{genieId:m},`${ve[m-1]}灯神免费扫荡`)});for(let m=0;m<3;m++)b.push({name:`领取免费扫荡卷 ${m+1}/3`,execute:()=>f(u,"genie_buysweep",{},`领取免费扫荡卷 ${m+1}`)});!H(12)&&v.blackMarketPurchase&&b.push({name:"黑市购买1次物品",execute:()=>f(u,"store_purchase",{goodsId:1},"黑市购买1次物品")});for(let m=1;m<=10;m++)b.push({name:`领取任务奖励${m}`,execute:()=>f(u,"task_claimdailypoint",{taskId:m},`领取任务奖励${m}`,5e3)});b.push({name:"领取日常任务奖励",execute:()=>f(u,"task_claimdailyreward",{},"领取日常任务奖励")},{name:"领取周常任务奖励",execute:()=>f(u,"task_claimweekreward",{},"领取周常任务奖励")});const ge=b.length;t(`共有 ${ge} 个任务待执行`);for(let m=0;m<b.length;m++){const Q=b[m];try{await Q.execute();const X=Math.floor((m+1)/ge*100);y&&y(u,X),await new Promise(R=>setTimeout(R,500))}catch(X){t(`任务执行失败: ${Q.name} - ${X.message}`,"error")}}y&&y(u,100),t("所有任务执行完成","success"),await new Promise(m=>setTimeout(m,2e3)),await p()},j=async()=>{var i;if(!n.selectedToken||$.value){r.warning("没有选中Token或正在执行中");return}if(!A.value){r.error("WebSocket连接未建立，请检查连接状态");return}$.value=!0,M.value=!0,I.value=[];try{a("=== 开始执行一键补差任务 ===");const t=await p();if(!(t!=null&&t.role))throw new Error("获取角色信息失败或数据异常");a(`当前每日任务进度: ${((i=t.role.dailyTask)==null?void 0:i.dailyPoint)||0}/100`),a("第二步: 开始执行每日任务..."),await me(t,a,(y,u)=>{a(`任务进度: ${u}%`)}),a("=== 任务执行完成 ===","success"),r.success("每日任务补差执行完成"),setTimeout(async()=>{try{await p(),a("最终角色信息刷新完成","success")}catch(y){a(`最终刷新失败: ${y.message}`,"warning")}},3e3)}catch(t){a(`任务执行失败: ${t.message}`,"error"),console.error("详细错误信息:",t),r.error(`任务执行失败: ${t.message}`)}finally{$.value=!1}},F=async()=>{if(!A.value){r.warning("WebSocket未连接，无法刷新任务状态");return}try{a("手动刷新任务状态..."),await p(),r.success("任务状态刷新成功")}catch(i){a(`刷新失败: ${i.message}`,"error"),r.error(`刷新失败: ${i.message}`)}},L=()=>n.selectedToken?{roleId:n.selectedToken.id}:null,ae=i=>{try{const t=localStorage.getItem(`daily-settings:${i}`);return t?JSON.parse(t):null}catch(t){return console.error("Failed to load settings:",t),null}},ne=(i,t)=>{try{localStorage.setItem(`daily-settings:${i}`,JSON.stringify(t))}catch(y){console.error("Failed to save settings:",y)}};return Z(v,i=>{const t=L();t&&ne(t.roleId,i)},{deep:!0}),Z(()=>n.selectedToken,async(i,t)=>{if(i&&i!==t){a(`切换到Token: ${i.name}`);const y=ae(i.id);if(y&&Object.assign(v,y),A.value)try{await p()}catch(u){console.warn("切换token后获取角色信息失败:",u.message)}}},{immediate:!0}),Z(()=>n.selectedTokenRoleInfo,i=>{var t,y;(y=(t=i==null?void 0:i.role)==null?void 0:t.dailyTask)!=null&&y.complete&&(a("角色信息更新，同步任务状态"),s(i))},{immediate:!0,deep:!0}),ue(async()=>{if(a("组件初始化完成"),n.selectedToken&&A.value)try{await p()}catch(t){console.warn("初始化时获取角色信息失败:",t.message)}const i=L();if(i){const t=ae(i.roleId);t&&Object.assign(v,t)}}),xe(()=>{a("组件即将卸载")}),(i,t)=>{const y=se("n-icon"),u=se("n-progress"),N=se("n-select"),W=se("n-switch"),H=se("n-modal"),D=se("n-tag");return _(),h("div",Tt,[e("div",bt,[t[16]||(t[16]=e("div",{class:"header-left"},[e("img",{src:kt,alt:"每日任务",class:"task-icon"}),e("div",{class:"title-container"},[e("h3",null,"每日任务"),e("p",null,"当前进度")])],-1)),e("div",wt,[e("div",{class:J(["status-indicator",{completed:T.value}]),onClick:t[0]||(t[0]=c=>o.value=!0)},[e("div",{class:J(["status-dot",{completed:T.value}])},null,2),t[15]||(t[15]=e("span",null,"任务详情",-1))],2),e("button",{class:"settings-button",onClick:t[1]||(t[1]=c=>l.value=!0)},[w(y,null,{default:P(()=>[w(G(ye))]),_:1})])])]),e("div",$t,[w(u,{type:"line",percentage:d.value,height:8,"border-radius":4,color:C.value,"rail-color":"#f3f4f6"},null,8,["percentage","color"])]),t[32]||(t[32]=e("div",{class:"info-container"}," 右上角小齿轮有惊喜 ",-1)),e("button",{class:"execute-button",disabled:$.value||!A.value,onClick:j},[$.value?(_(),h("span",xt,t[17]||(t[17]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),Y(" 执行中... ",-1)]))):A.value?(_(),h("span",It,"一键补差")):(_(),h("span",Ct,"WebSocket未连接"))],8,St),w(H,{show:l.value,"onUpdate:show":t[12]||(t[12]=c=>l.value=c),preset:"card",title:"任务设置",style:{width:"400px"}},{header:P(()=>[e("div",Mt,[w(y,null,{default:P(()=>[w(G(ye))]),_:1}),t[18]||(t[18]=e("span",null,"任务设置",-1))])]),default:P(()=>[e("div",Dt,[e("div",Bt,[e("div",Wt,[t[19]||(t[19]=e("label",{class:"setting-label"},"竞技场阵容",-1)),w(N,{value:v.arenaFormation,"onUpdate:value":t[2]||(t[2]=c=>v.arenaFormation=c),options:G(q),size:"small"},null,8,["value","options"])]),e("div",Ut,[t[20]||(t[20]=e("label",{class:"setting-label"},"BOSS阵容",-1)),w(N,{value:v.bossFormation,"onUpdate:value":t[3]||(t[3]=c=>v.bossFormation=c),options:G(q),size:"small"},null,8,["value","options"])]),e("div",Et,[t[21]||(t[21]=e("label",{class:"setting-label"},"BOSS次数",-1)),w(N,{value:v.bossTimes,"onUpdate:value":t[4]||(t[4]=c=>v.bossTimes=c),options:G(z),size:"small"},null,8,["value","options"])]),e("div",Ot,[e("div",zt,[t[22]||(t[22]=e("span",{class:"switch-label"},"领罐子",-1)),w(W,{value:v.claimBottle,"onUpdate:value":t[5]||(t[5]=c=>v.claimBottle=c)},null,8,["value"])]),e("div",Ht,[t[23]||(t[23]=e("span",{class:"switch-label"},"领挂机",-1)),w(W,{value:v.claimHangUp,"onUpdate:value":t[6]||(t[6]=c=>v.claimHangUp=c)},null,8,["value"])]),e("div",At,[t[24]||(t[24]=e("span",{class:"switch-label"},"竞技场",-1)),w(W,{value:v.arenaEnable,"onUpdate:value":t[7]||(t[7]=c=>v.arenaEnable=c)},null,8,["value"])]),e("div",Nt,[t[25]||(t[25]=e("span",{class:"switch-label"},"开宝箱",-1)),w(W,{value:v.openBox,"onUpdate:value":t[8]||(t[8]=c=>v.openBox=c)},null,8,["value"])]),e("div",Rt,[t[26]||(t[26]=e("span",{class:"switch-label"},"领取邮件奖励",-1)),w(W,{value:v.claimEmail,"onUpdate:value":t[9]||(t[9]=c=>v.claimEmail=c)},null,8,["value"])]),e("div",Pt,[t[27]||(t[27]=e("span",{class:"switch-label"},"黑市购买物品",-1)),w(W,{value:v.blackMarketPurchase,"onUpdate:value":t[10]||(t[10]=c=>v.blackMarketPurchase=c)},null,8,["value"])]),e("div",Vt,[t[28]||(t[28]=e("span",{class:"switch-label"},"付费招募",-1)),w(W,{value:v.payRecruit,"onUpdate:value":t[11]||(t[11]=c=>v.payRecruit=c)},null,8,["value"])])])])])]),_:1},8,["show"]),w(H,{show:o.value,"onUpdate:show":t[13]||(t[13]=c=>o.value=c),preset:"card",title:"每日任务详情",style:{width:"400px"}},{header:P(()=>[e("div",Lt,[w(y,null,{default:P(()=>[w(G(ze))]),_:1}),t[30]||(t[30]=e("span",null,"每日任务详情",-1)),e("button",{class:"refresh-button",disabled:$.value,onClick:F},[w(y,null,{default:P(()=>[w(G(De))]),_:1}),t[29]||(t[29]=Y(" 刷新状态 ",-1))],8,Gt)])]),default:P(()=>[e("div",jt,[(_(!0),h(le,null,pe(O.value,c=>(_(),h("div",{key:c.id,class:"task-item"},[e("div",Jt,[w(y,{class:J(["task-status-icon",{completed:c.completed}])},{default:P(()=>[c.completed?(_(),he(G(Me),{key:0})):(_(),he(G(Ye),{key:1}))]),_:2},1032,["class"]),e("span",qt,S(c.name),1)]),w(D,{type:c.completed?"success":"default",size:"small"},{default:P(()=>[Y(S(c.completed?"已完成":"未完成"),1)]),_:2},1032,["type"])]))),128))])]),_:1},8,["show"]),w(H,{show:M.value,"onUpdate:show":t[14]||(t[14]=c=>M.value=c),preset:"card",title:"任务执行日志",style:{width:"500px"}},{header:P(()=>[e("div",Xt,[w(y,null,{default:P(()=>[w(G(je))]),_:1}),t[31]||(t[31]=e("span",null,"任务执行日志",-1))])]),default:P(()=>[e("div",{ref_key:"logContainer",ref:E,class:"log-container"},[(_(!0),h(le,null,pe(I.value,c=>(_(),h("div",{key:c.time+c.message,class:"log-item"},[e("span",Yt,S(c.time),1),e("span",{class:J(["log-message",{error:c.type==="error",success:c.type==="success",warning:c.type==="warning"}])},S(c.message),3)]))),128))],512)]),_:1},8,["show"])])}}},Qt=de(Kt,[["__scopeId","data-v-44eba1bd"]]),Zt={class:"tower-status-card"},Ft={class:"card-header"},es={class:"energy-display"},ts={class:"energy-count"},ss={class:"card-content"},as={class:"tower-floor"},ns={class:"floor-number"},os={class:"card-actions"},ls=["disabled"],is={__name:"TowerStatus",setup(te){const n=ce(),r=re(),l=B(!1),o=B(null);B(null);const M=U(()=>{var d;return((d=n.gameData)==null?void 0:d.roleInfo)||null}),$=U(()=>{var A,I;const g=(I=(A=M.value)==null?void 0:A.role)==null?void 0:I.tower;if(!g||!g.id&&g.id!==0)return"0 - 0";const d=g.id,T=Math.floor(d/10)+1,C=d%10+1;return`${T} - ${C}`}),E=U(()=>{var T,C;const g=(C=(T=M.value)==null?void 0:T.role)==null?void 0:C.tower;return(g==null?void 0:g.energy)||0}),v=U(()=>{const g=E.value>0,d=!l.value;return g&&d}),O=async()=>{if(!n.selectedToken){r.warning("请先选择Token");return}if(!v.value){r.warning("体力不足或正在爬塔中");return}o.value&&(clearTimeout(o.value),o.value=null),l.value=!0,o.value=setTimeout(()=>{l.value=!1,o.value=null},15e3);try{const g=n.selectedToken.id;await n.sendMessageWithPromise(g,"fight_starttower",{},1e4),r.success("爬塔命令已发送"),await z(),setTimeout(async()=>{await z(),o.value&&(clearTimeout(o.value),o.value=null),l.value=!1},2e3)}catch(g){r.error("爬塔失败: "+(g.message||"未知错误")),o.value&&(clearTimeout(o.value),o.value=null),l.value=!1}},q=()=>{o.value&&(clearTimeout(o.value),o.value=null),l.value=!1,r.info("爬塔状态已重置")},z=async()=>{if(!n.selectedToken){console.warn("🗼 getTowerInfo: 没有选中的Token");return}try{const g=n.selectedToken.id;if(n.getWebSocketStatus(g)!=="connected")return;const T=n.sendMessage(g,"role_getroleinfo"),C=n.sendMessage(g,"tower_getinfo");!T&&!C&&console.error("🗼 getTowerInfo: 所有请求都失败了")}catch(g){console.error("🗼 getTowerInfo: 获取塔信息失败:",g)}},K=U(()=>n.selectedToken?n.getWebSocketStatus(n.selectedToken.id):"disconnected");return Z(K,(g,d)=>{console.log(`🗼 WebSocket状态变化: ${d} -> ${g}`),g==="connected"&&d!=="connected"&&(console.log("🗼 WebSocket已连接，自动获取塔信息"),setTimeout(()=>{z()},1e3))}),Z(()=>n.selectedToken,(g,d)=>{g&&g.id!==(d==null?void 0:d.id)&&(console.log("🗼 Token已切换，获取新的塔信息"),n.getWebSocketStatus(g.id)==="connected"&&z())}),Z(()=>n.gameData.towerResult,(g,d)=>{g&&g.timestamp!==(d==null?void 0:d.timestamp)&&(console.log("🗼 收到新的爬塔结果:",g),g.success?(r.success("咸将塔挑战成功！"),g.autoReward&&setTimeout(()=>{r.success(`自动领取第${g.rewardFloor}层奖励`)},1e3)):r.error("咸将塔挑战失败"),setTimeout(()=>{console.log("🗼 爬塔结果处理完成，重置状态"),o.value&&(clearTimeout(o.value),o.value=null),l.value=!1},2e3))},{deep:!0}),ue(()=>{n.selectedToken&&n.getWebSocketClient(n.selectedToken.id),n.selectedToken&&K.value==="connected"?z():n.selectedToken?console.log("🗼 WebSocket未连接，等待连接后自动获取塔信息"):console.log("🗼 没有选中的Token，无法获取塔信息")}),(g,d)=>(_(),h("div",Zt,[e("div",Ft,[d[1]||(d[1]=e("div",{class:"header-info"},[e("img",{src:we,alt:"爬塔图标",class:"tower-icon"}),e("div",{class:"tower-info"},[e("h3",null,"咸将塔"),e("p",null,"一个不小心就过了")])],-1)),e("div",es,[d[0]||(d[0]=e("img",{src:Be,alt:"小鱼干",class:"energy-icon"},null,-1)),e("span",ts,S(E.value),1)])]),e("div",ss,[e("div",as,[d[2]||(d[2]=e("span",{class:"label"},"当前层数",-1)),e("span",ns,S($.value),1)])]),e("div",os,[e("button",{class:J(["climb-button",{active:v.value,disabled:!v.value}]),disabled:!v.value,onClick:O},S(l.value.value?"爬塔中...":"开始爬塔"),11,ls),l.value.value?(_(),h("button",{key:0,class:"reset-button",onClick:q}," 重置状态 ")):oe("",!0)])]))}},cs=de(is,[["__scopeId","data-v-23f2c101"]]),rs={class:"game-status-container"},us={class:"status-card bottle-helper"},ds={class:"card-header"},ms={class:"card-content"},ps={class:"time-display"},vs={class:"status-card hang-up"},gs={class:"card-header"},fs={class:"status-info"},_s={class:"card-content"},hs={class:"time-display"},ys={class:"action-row"},ks=["disabled"],Ts={key:0,class:"loading-text"},bs={key:1},ws=["disabled"],$s={key:0,class:"loading-text"},Ss={key:1},xs={class:"status-card legion-match"},Cs={class:"card-header"},Is={class:"card-content"},Ms=["disabled"],Ds={class:"status-card legion-signin"},Bs={class:"card-header"},Ws={class:"card-content"},Us={key:0,class:"club-name"},Es={key:1,class:"description"},Os=["disabled"],zs={class:"status-card study"},Hs={class:"card-content"},As=["disabled"],Ns={key:0,class:"loading-text"},Rs={key:1},Ps={__name:"GameStatus",setup(te){const n=ce(),r=re(),l=B({isRunning:!1,remainingTime:0,stopTime:0}),o=B({isActive:!1,remainingTime:0,elapsedTime:0,lastTime:0,hangUpTime:0,isExtending:!1,isClaiming:!1}),M=B({isRegistered:!1}),$=B({isSignedIn:!1,clubName:""}),E=B({isAnswering:!1}),v=U(()=>{var a;return((a=n.gameData)==null?void 0:a.roleInfo)||null}),O=a=>{const s=Math.floor(Number(a)||0);if(s<=0)return"00:00:00";const p=Math.floor(s/3600),f=Math.floor(s%3600/60),k=s%60;return`${p.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}`},q=()=>{if(!v.value)return;const a=v.value.role;if(a.bottleHelpers){const s=Date.now()/1e3;l.value.stopTime=a.bottleHelpers.helperStopTime,l.value.isRunning=a.bottleHelpers.helperStopTime>s,l.value.remainingTime=Math.max(0,Math.floor(a.bottleHelpers.helperStopTime-s)),console.log("🤖 盐罐机器人状态更新:",{stopTime:a.bottleHelpers.helperStopTime,now:s,remainingTime:l.value.remainingTime,isRunning:l.value.isRunning})}if(a.hangUp){const s=Date.now()/1e3;o.value.lastTime=a.hangUp.lastTime,o.value.hangUpTime=a.hangUp.hangUpTime;const p=s-o.value.lastTime;p<=o.value.hangUpTime?(o.value.remainingTime=Math.floor(o.value.hangUpTime-p),o.value.isActive=!0):(o.value.remainingTime=0,o.value.isActive=!1),o.value.elapsedTime=Math.floor(o.value.hangUpTime-o.value.remainingTime),console.log("⏰ 挂机状态更新:",{lastTime:o.value.lastTime,hangUpTime:o.value.hangUpTime,elapsed:p,remainingTime:o.value.remainingTime,elapsedTime:o.value.elapsedTime,isActive:o.value.isActive})}if(a.statistics){const s=new Date;s.setHours(0,0,0,0);const p=s.getTime()/1e3;M.value.isRegistered=Number(a.statistics["last:legion:match:sign:up:time"])>p}if(a.statisticsTime){const s=new Date;s.setHours(0,0,0,0);const p=s.getTime()/1e3;$.value.isSignedIn=a.statisticsTime["legion:sign:in"]>p}};let z=null;const K=()=>{z&&clearInterval(z),z=setInterval(()=>{l.value.isRunning&&l.value.remainingTime>0&&(l.value.remainingTime=Math.max(0,l.value.remainingTime-1),l.value.remainingTime<=0&&(l.value.isRunning=!1)),o.value.isActive&&o.value.remainingTime>0&&(o.value.remainingTime=Math.max(0,o.value.remainingTime-1),o.value.elapsedTime=o.value.elapsedTime+1,o.value.remainingTime<=0&&(o.value.isActive=!1))},1e3)},g=()=>{if(!n.selectedToken){r.warning("请先选择Token");return}const a=n.selectedToken.id;n.sendMessage(a,"bottlehelper_stop"),setTimeout(()=>{n.sendMessage(a,"bottlehelper_start"),n.sendMessage(a,"role_getroleinfo")},500),r.info(l.value.isRunning?"重启盐罐机器人":"启动盐罐机器人")},d=async()=>{if(!n.selectedToken){r.warning("请先选择Token");return}const a=n.selectedToken.id;try{console.log("🕐 开始加钟操作..."),o.value.isExtending=!0,r.info("正在加钟...");const s=[];for(let p=0;p<4;p++){const f=new Promise(k=>{setTimeout(()=>{console.log(`🕐 发送第${p+1}次加钟请求`);const x=n.sendMessage(a,"system_mysharecallback",{isSkipShareCard:!0,type:2});k(x)},p*300)});s.push(f)}await Promise.all(s),console.log("🕐 所有加钟请求已发送"),setTimeout(()=>{console.log("🕐 加钟后获取最新角色信息"),n.sendMessage(a,"role_getroleinfo")},1500),setTimeout(()=>{r.success("加钟操作已完成，请查看挂机剩余时间"),o.value.isExtending=!1},2500)}catch(s){console.error("🕐 加钟操作失败:",s),r.error("加钟操作失败: "+(s.message||"未知错误")),o.value.isExtending=!1}},T=async()=>{if(!n.selectedToken){r.warning("请先选择Token");return}const a=n.selectedToken.id;try{console.log("🎁 开始领取挂机奖励..."),o.value.isClaiming=!0,r.info("正在领取挂机奖励..."),n.sendMessage(a,"system_mysharecallback"),setTimeout(()=>{n.sendMessage(a,"system_claimhangupreward")},200),setTimeout(()=>{n.sendMessage(a,"system_mysharecallback",{isSkipShareCard:!0,type:2})},400),setTimeout(()=>{n.sendMessage(a,"role_getroleinfo")},600),setTimeout(()=>{r.success("挂机奖励领取完成"),o.value.isClaiming=!1},1200),console.log("🎁 挂机奖励领取操作序列已启动")}catch(s){console.error("🎁 领取挂机奖励失败:",s),r.error("领取挂机奖励失败: "+(s.message||"未知错误")),o.value.isClaiming=!1}},C=()=>{if(!n.selectedToken||M.value.isRegistered)return;const a=n.selectedToken.id;n.sendMessage(a,"legionmatch_rolesignup"),r.info("报名俱乐部排位")},A=()=>{if(!n.selectedToken||$.value.isSignedIn)return;const a=n.selectedToken.id;n.sendMessage(a,"legion_signin"),n.sendMessage(a,"role_getroleinfo"),r.info("俱乐部签到")},I=()=>{if(!n.selectedToken||E.value.isAnswering)return;E.value.isAnswering=!0;const a=n.selectedToken.id;n.sendMessage(a,"study_startgame"),setTimeout(()=>{E.value.isAnswering=!1},3e3),r.info("开始答题")};return Z(v,a=>{a&&q()},{deep:!0,immediate:!0}),ue(()=>{if(q(),K(),n.selectedToken){const a=n.selectedToken.id;n.sendMessage(a,"legion_getinfo")}}),be(()=>{z&&clearInterval(z)}),(a,s)=>(_(),h("div",rs,[w(yt),w(Qt),w(cs),e("div",us,[e("div",ds,[s[1]||(s[1]=e("img",{src:Ke,alt:"盐罐图标",class:"status-icon"},null,-1)),s[2]||(s[2]=e("div",{class:"status-info"},[e("h3",null,"盐罐机器人"),e("p",null,"剩余时间")],-1)),e("div",{class:J(["status-badge",{active:l.value.isRunning}])},[s[0]||(s[0]=e("div",{class:"status-dot"},null,-1)),e("span",null,S(l.value.isRunning?"运行中":"已停止"),1)],2)]),e("div",ms,[e("div",ps,S(O(l.value.remainingTime)),1),e("button",{class:J(["action-button",{active:l.value.isRunning}]),onClick:g},S(l.value.isRunning?"重启服务":"启动服务"),3)])]),e("div",vs,[e("div",gs,[s[5]||(s[5]=e("img",{src:Qe,alt:"挂机图标",class:"status-icon"},null,-1)),e("div",fs,[s[3]||(s[3]=e("h3",null,"挂机时间",-1)),e("p",null,"已挂机："+S(O(o.value.elapsedTime)),1)]),e("div",{class:J(["status-badge",{active:o.value.isActive}])},[s[4]||(s[4]=e("div",{class:"status-dot"},null,-1)),e("span",null,S(o.value.isActive?"挂机中":"已完成"),1)],2)]),e("div",_s,[e("div",hs,S(O(o.value.remainingTime)),1),e("div",ys,[e("button",{class:"action-button secondary",disabled:o.value.isExtending,onClick:d},[o.value.isExtending?(_(),h("span",Ts,s[6]||(s[6]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),Y(" 加钟中... ",-1)]))):(_(),h("span",bs,"加钟"))],8,ks),e("button",{class:"action-button primary",disabled:o.value.isClaiming,onClick:T},[o.value.isClaiming?(_(),h("span",$s,s[7]||(s[7]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),Y(" 领取中... ",-1)]))):(_(),h("span",Ss,"领取奖励"))],8,ws)])])]),e("div",xs,[e("div",Cs,[s[9]||(s[9]=e("img",{src:Ze,alt:"俱乐部图标",class:"status-icon"},null,-1)),s[10]||(s[10]=e("div",{class:"status-info"},[e("h3",null,"俱乐部排位"),e("p",null,"赛事状态")],-1)),e("div",{class:J(["status-badge",{active:M.value.isRegistered}])},[s[8]||(s[8]=e("div",{class:"status-dot"},null,-1)),e("span",null,S(M.value.isRegistered?"已报名":"未报名"),1)],2)]),e("div",Is,[s[11]||(s[11]=e("p",{class:"description"},[Y(" 每逢周三周四周五有比赛"),e("br"),Y(" 立即报名参与精彩对决！ ")],-1)),e("button",{class:"action-button",disabled:M.value.isRegistered,onClick:C},S(M.value.isRegistered?"已报名":"立即报名"),9,Ms)])]),e("div",Ds,[e("div",Bs,[s[13]||(s[13]=e("img",{src:we,alt:"签到图标",class:"status-icon"},null,-1)),s[14]||(s[14]=e("div",{class:"status-info"},[e("h3",null,"俱乐部签到"),e("p",null,"每日签到状态")],-1)),e("div",{class:J(["status-badge",{active:$.value.isSignedIn}])},[s[12]||(s[12]=e("div",{class:"status-dot"},null,-1)),e("span",null,S($.value.isSignedIn?"已签到":"待签到"),1)],2)]),e("div",Ws,[$.value.clubName?(_(),h("p",Us,[s[15]||(s[15]=Y(" 当前俱乐部",-1)),s[16]||(s[16]=e("br",null,null,-1)),e("strong",null,S($.value.clubName),1)])):(_(),h("p",Es," 尚未加入任何俱乐部 ")),e("button",{class:"action-button",disabled:$.value.isSignedIn,onClick:A},S($.value.isSignedIn?"已签到":"立即签到"),9,Os)])]),e("div",zs,[s[19]||(s[19]=Te('<div class="card-header" data-v-38ca80a0><img src="'+Fe+'" alt="学习图标" class="status-icon" data-v-38ca80a0><div class="status-info" data-v-38ca80a0><h3 data-v-38ca80a0>咸鱼大冲关</h3><p data-v-38ca80a0>每日知识挑战</p></div><div class="status-badge weekly" data-v-38ca80a0><div class="status-dot" data-v-38ca80a0></div><span data-v-38ca80a0>每周任务</span></div></div>',1)),e("div",Hs,[s[18]||(s[18]=e("p",{class:"description"}," 没有什么可以阻挡我求知的欲望！ ",-1)),e("button",{class:"action-button",disabled:E.value.isAnswering,onClick:I},[E.value.isAnswering?(_(),h("span",Ns,s[17]||(s[17]=[e("svg",{class:"loading-icon",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M12 22c5.421 0 10-4.579 10-10h-2c0 4.337-3.663 8-8 8s-8-3.663-8-8c0-4.336 3.663-8 8-8V2C6.579 2 2 6.58 2 12c0 5.421 4.579 10 10 10z"})],-1),Y(" 答题中... ",-1)]))):(_(),h("span",Rs,"一键答题"))],8,As)])])]))}},Vs=de(Ps,[["__scopeId","data-v-38ca80a0"]]),Ls={class:"game-features-page"},Gs={class:"page-header"},js={class:"container"},Js={class:"header-content"},qs={class:"header-left"},Xs={class:"page-subtitle"},Ys={class:"header-actions"},Ks={key:0,class:"feedback-section"},Qs={class:"features-grid-section"},Zs={class:"container"},Fs={class:"ws-status-section"},ea={class:"container"},ta={class:"ws-status-card"},sa={class:"status-header"},aa={class:"status-content"},na={class:"status-item"},oa={key:0,class:"status-item"},la={key:1,class:"status-item"},ia={__name:"GameFeatures",setup(te){const n=Ie(),r=re(),l=ce(),o=B(!0),M=B(null),$=U(()=>l.selectedToken&&l.getWebSocketStatus(l.selectedToken.id)==="connected"?"connected":"disconnected"),E=U(()=>l.selectedToken?l.getWebSocketStatus(l.selectedToken.id)==="connected"?"已连接":"未连接":"未选择Token"),v=U(()=>$.value==="connected"?"status-connected":"status-disconnected"),O=U(()=>$.value==="connected"),q=()=>{if(!l.selectedToken){r.warning("请先选择一个Token"),n.push("/tokens");return}try{const d=l.selectedToken.id,T=l.selectedToken.token;l.createWebSocketConnection(d,T),r.info("正在建立 WebSocket 连接..."),setTimeout(async()=>{l.getWebSocketStatus(d)==="connected"&&(r.success("WebSocket 连接成功"),await g())},2e3)}catch(d){console.error("WebSocket连接失败:",d),r.error("WebSocket连接失败")}},z=()=>{if(l.selectedToken){const d=l.selectedToken.id;l.closeWebSocketConnection(d),r.info("WebSocket连接已断开")}},K=()=>{$.value==="connected"?z():q()};ue(()=>{l.selectedToken&&(l.getWebSocketStatus(l.selectedToken.id)!=="connected"?q():g())});const g=async()=>{if(l.selectedToken)try{const d=l.selectedToken.id;console.log("🎮 初始化游戏数据..."),console.log("🎮 正在获取角色信息...");const T=l.sendMessage(d,"role_getroleinfo");console.log("🎮 角色信息请求结果:",T),console.log("🎮 正在获取塔信息...");const C=l.sendMessage(d,"tower_getinfo");console.log("🎮 塔信息请求结果:",C),console.log("🎮 正在获取队伍信息...");const A=l.sendMessage(d,"presetteam_getinfo");console.log("🎮 队伍信息请求结果:",A),console.log("🎮 游戏数据初始化请求已发送")}catch(d){console.warn("初始化游戏数据失败:",d)}};return be(()=>{}),(d,T)=>{var I;const C=se("n-icon"),A=se("n-button");return _(),h("div",Ls,[e("div",Gs,[e("div",js,[e("div",Js,[e("div",qs,[T[0]||(T[0]=e("h1",{class:"page-title"}," 游戏功能 ",-1)),e("p",Xs,S(((I=G(l).selectedToken)==null?void 0:I.name)||"未选择Token"),1)]),e("div",Ys,[e("div",{class:J(["connection-status",$.value])},[w(C,null,{default:P(()=>[w(G(Re))]),_:1}),e("span",null,S(E.value),1)],2)])])])]),o.value?(_(),h("div",Ks)):oe("",!0),e("div",Qs,[e("div",Zs,[w(Vs)])]),e("div",Fs,[e("div",ea,[e("div",ta,[e("div",sa,[T[1]||(T[1]=e("h3",null,"连接状态",-1)),w(A,{text:"",onClick:K},{default:P(()=>[Y(S(O.value?"断开连接":"重新连接"),1)]),_:1})]),e("div",aa,[e("div",na,[T[2]||(T[2]=e("span",null,"WebSocket状态:",-1)),e("span",{class:J(v.value)},S(E.value),3)]),G(l).selectedToken?(_(),h("div",oa,[T[3]||(T[3]=e("span",null,"当前Token:",-1)),e("span",null,S(G(l).selectedToken.name),1)])):oe("",!0),M.value?(_(),h("div",la,[T[4]||(T[4]=e("span",null,"最后活动:",-1)),e("span",null,S(M.value),1)])):oe("",!0)])])])])])}}},va=de(ia,[["__scopeId","data-v-6e2460c3"]]);export{va as default};
