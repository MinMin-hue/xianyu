import{c as l,e as c,a as n,m as u,n as g,t as d,p as k,q as w,o as h}from"./index-DhCM_Bam.js";import{_ as v}from"./_plugin-vue_export-helper-DlAUqK2U.js";const m={name:"ImportToken",data(){return{selectedFile:null,progressPercent:0,showProgress:!1,statusMessage:"",statusType:"",showStatusMessage:!1,extractedToken:"",showResult:!1,responseDetails:"",showResponseInfo:!1,debugDetails:"",showDebugInfo:!1,wssLink:"",isUploading:!1}},computed:{fileInfoText(){return this.selectedFile?`已选择: ${this.selectedFile.name} (${this.formatFileSize(this.selectedFile.size)})`:""}},methods:{handleUploadAreaClick(r){r.target!==this.$refs.fileInput&&this.$refs.fileInput.click()},highlight(){document.getElementById("uploadArea").classList.add("dragover")},unhighlight(){document.getElementById("uploadArea").classList.remove("dragover")},handleDrop(r){this.unhighlight();const t=r.dataTransfer.files;t.length&&this.handleFiles(t)},handleFileChange(){this.$refs.fileInput.files.length&&this.handleFiles(this.$refs.fileInput.files)},handleFiles(r){const e=r[0];if(!e.name.toLowerCase().endsWith(".bin")){this.showStatus("请选择.bin格式的文件","error");return}this.selectedFile=e},formatFileSize(r){if(r===0)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(r)/Math.log(e));return parseFloat((r/Math.pow(e,a)).toFixed(2))+" "+t[a]},async uploadFile(){if(!this.selectedFile){this.showStatus("请先选择文件","error");return}this.isUploading=!0,this.showProgress=!0,this.progressPercent=0,this.showStatus("正在上传文件...","");try{const r=await this.readFileAsArrayBuffer(this.selectedFile),e=new XMLHttpRequest;e.open("POST","https://xxz-xyzw.hortorgames.com/login/authuser?_seq=1",!0),e.responseType="arraybuffer",e.upload.addEventListener("progress",t=>{if(t.lengthComputable){const a=t.loaded/t.total*100;this.progressPercent=Math.round(a)}}),await new Promise((t,a)=>{e.addEventListener("load",()=>{if(e.status>=200&&e.status<300)try{const s=e.response;s?(this.extractRoleToken(s),this.showStatus("Token提取成功！","success"),t()):(this.showStatus("上传成功，但响应为空","error"),a(new Error("Empty response")))}catch(s){this.showStatus("处理响应时出错: "+s.message,"error"),a(s)}else this.showStatus("上传失败: "+e.statusText,"error"),a(new Error(`HTTP error: ${e.status}`))}),e.addEventListener("error",()=>{this.showStatus("上传过程中发生错误","error"),a(new Error("Network error"))}),e.setRequestHeader("Content-Type","application/octet-stream"),e.send(r)})}catch(r){console.error("Upload error:",r)}finally{this.isUploading=!1}},readFileAsArrayBuffer(r){return new Promise((e,t)=>{const a=new FileReader;a.onload=s=>e(s.target.result),a.onerror=()=>t(a.error),a.readAsArrayBuffer(r)})},extractRoleToken(r){try{const e=new Uint8Array(r);let t="";for(let s=0;s<e.length;s++)e[s]>=32&&e[s]<=126?t+=String.fromCharCode(e[s]):t+=".";this.debugDetails=`ASCII预览:
`+t,this.showDebugInfo=!0;const a=t.indexOf("Token");if(a!==-1){let s=a+5;for(;s<t.length;){const p=t[s];if(this.isBase64Char(p))break;s++}let o=s;for(;o<t.length&&this.isBase64Char(t[o]);)o++;const i=t.substring(s,o);if(i.length>0){this.extractedToken=i,this.showResult=!0,this.generateAndDisplayWssLink(i);let p="";for(let f=0;f<e.length;f++)(f+1)%16===0&&(p+=`
`),p+=e[f].toString(16).padStart(2,"0")+" ";this.responseDetails=p,this.showResponseInfo=!0,this.$nextTick(()=>{document.querySelector(".result-container").scrollIntoView({behavior:"smooth"})})}else this.showStatus("找到Token标记但未找到Token值","error")}else this.showStatus("在响应中未找到Token标记","error")}catch(e){this.showStatus("提取Token时发生错误: "+e.message,"error")}},isBase64Char(r){return/[A-Za-z0-9+/=]/.test(r)},showStatus(r,e){this.statusMessage=r,this.statusType=e||"",this.showStatusMessage=!0},copyToken(){this.extractedToken&&navigator.clipboard.writeText(this.extractedToken).then(()=>this.showStatus("Token已复制到剪贴板","success")).catch(()=>this.showStatus("复制失败","error"))},copyWssLink(){this.wssLink&&navigator.clipboard.writeText(this.wssLink).then(()=>this.showStatus("WSS链接已复制到剪贴板","success")).catch(()=>this.showStatus("复制失败","error"))},generateAndDisplayWssLink(r){const e=Date.now(),t=e*100+Math.floor(Math.random()*100),a=e+Math.floor(Math.random()*10);this.wssLink=`{"roleToken":"${r}","sessId":${t},"connId":${a},"isRestore":0}`}}},y={class:"container"},T={key:0,class:"file-info"},S={key:1,class:"progress-container"},x={class:"progress-bar"},I={class:"progress-text"},b=["disabled"],F={key:3,class:"result-container"},C={class:"token-display"},B={class:"token-info",style:{"margin-top":"20px","background-color":"#e8f5e9"}},D={class:"wss-link-display"},A={key:4,class:"debug-info"},M={class:"response-details"},L={key:5,class:"response-info"},R={class:"response-details"};function P(r,e,t,a,s,o){return h(),l("div",y,[e[17]||(e[17]=c('<div class="logo" data-v-f25970e0><span data-v-f25970e0>🔑</span></div><h1 data-v-f25970e0>RoleToken 提取工具</h1><p class="description" data-v-f25970e0>上传BIN文件从服务器响应中提取RoleToken并生成WebSocket链接</p><div class="api-info" data-v-f25970e0><h3 data-v-f25970e0>API信息</h3><div class="api-details" data-v-f25970e0><p data-v-f25970e0><strong data-v-f25970e0>端点:</strong> https://xxz-xyzw.hortorgames.com/login/authuser?_seq=1</p><p data-v-f25970e0><strong data-v-f25970e0>方法:</strong> POST</p><p data-v-f25970e0><strong data-v-f25970e0>请求体:</strong> BIN文件内容</p><p data-v-f25970e0><strong data-v-f25970e0>响应:</strong> 二进制数据 (包含RoleToken)</p></div></div>',4)),n("div",{class:"upload-area",id:"uploadArea",onClick:e[1]||(e[1]=(...i)=>o.handleUploadAreaClick&&o.handleUploadAreaClick(...i)),onDragenter:e[2]||(e[2]=g((...i)=>o.highlight&&o.highlight(...i),["prevent"])),onDragover:e[3]||(e[3]=g((...i)=>o.highlight&&o.highlight(...i),["prevent"])),onDragleave:e[4]||(e[4]=g((...i)=>o.unhighlight&&o.unhighlight(...i),["prevent"])),onDrop:e[5]||(e[5]=g((...i)=>o.handleDrop&&o.handleDrop(...i),["prevent"]))},[e[9]||(e[9]=n("div",{class:"upload-icon"},"📂",-1)),e[10]||(e[10]=n("p",{class:"upload-text"},"点击或拖放BIN文件到此处",-1)),e[11]||(e[11]=n("p",{class:"upload-subtext"},"仅支持 .bin 格式文件",-1)),n("input",{type:"file",ref:"fileInput",class:"file-input",accept:".bin",onChange:e[0]||(e[0]=(...i)=>o.handleFileChange&&o.handleFileChange(...i))},null,544)],32),s.selectedFile?(h(),l("div",T,d(o.fileInfoText),1)):u("",!0),s.showProgress?(h(),l("div",S,[n("div",x,[n("div",{class:"progress",style:k({width:s.progressPercent+"%"})},null,4)]),n("div",I,d(s.progressPercent)+"%",1)])):u("",!0),s.showStatusMessage?(h(),l("div",{key:2,class:w(["status-message",s.statusType])},d(s.statusMessage),3)):u("",!0),n("button",{class:"btn",onClick:e[6]||(e[6]=(...i)=>o.uploadFile&&o.uploadFile(...i)),disabled:!s.selectedFile||s.isUploading},"上传BIN文件提取Token",8,b),s.showResult?(h(),l("div",F,[e[13]||(e[13]=n("div",{class:"result-title"},"提取到的 RoleToken:",-1)),n("div",C,d(s.extractedToken),1),n("button",{class:"copy-btn",onClick:e[7]||(e[7]=(...i)=>o.copyToken&&o.copyToken(...i))},"复制Token"),e[14]||(e[14]=n("div",{class:"token-info"},[n("h3",null,"Token使用说明"),n("p",null,"将此Token用于WebSocket连接认证："),n("div",{class:"usage-example"},' ws://xxz-xyzw.hortorgames.com/agent?p={"roleToken":"你的Token","sessId":175742937218840,"connId":1757429372191,"isRestore":0} ')],-1)),n("div",B,[e[12]||(e[12]=n("h3",null,"完整WebSocket链接",-1)),n("div",D,d(s.wssLink),1),n("button",{class:"copy-btn",onClick:e[8]||(e[8]=(...i)=>o.copyWssLink&&o.copyWssLink(...i)),style:{background:"#4caf50","margin-top":"10px"}},"复制完整WSS链接")])])):u("",!0),s.showDebugInfo?(h(),l("div",A,[e[15]||(e[15]=n("h3",null,"调试信息:",-1)),n("div",M,d(s.debugDetails),1)])):u("",!0),s.showResponseInfo?(h(),l("div",L,[e[16]||(e[16]=n("h3",null,"原始响应数据 (十六进制格式):",-1)),n("div",R,d(s.responseDetails),1)])):u("",!0)])}const W=v(m,[["render",P],["__scopeId","data-v-f25970e0"]]);export{W as default};
